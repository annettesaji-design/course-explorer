<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Course Explorer</title>

  <!-- Tailwind CDN (OK for assignments) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    body { font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background: #fdf7e3; }
    .card { background: white; border-radius: 12px; box-shadow: 0 6px 18px rgba(22,22,22,0.06); padding: 16px; }
    .small { font-size: 0.9rem; color: #475569; }
  </style>
</head>
<body class="min-h-screen p-6">

  <div class="max-w-6xl mx-auto">
    <header class="mb-6 text-center">
      <h1 class="text-3xl font-semibold">Course Explorer</h1>
    </header>

    <!-- Controls -->
    <section class="card mb-6">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
        <input id="search" placeholder="Search by title, instructor or category" class="p-2 border rounded-md col-span-1 md:col-span-2" />
        <select id="category" class="p-2 border rounded-md">
          <option value="">All categories</option>
        </select>
        <select id="sort" class="p-2 border rounded-md">
          <option value="rating_desc">Rating: high → low</option>
          <option value="rating_asc">Rating: low → high</option>
          <option value="price_asc">Price: low → high</option>
          <option value="price_desc">Price: high → low</option>
          <option value="enrolled_desc">Enrolled: high → low</option>
        </select>
      </div>
      <div class="mt-3 flex items-center justify-between">
        <div class="small text-slate-600">Show per page:
          <select id="pageSize" class="ml-2 p-1 border rounded-md">
            <option>4</option><option selected>6</option><option>8</option>
          </select>
        </div>
        <div id="resultsInfo" class="small text-slate-600"></div>
      </div>
    </section>

    <!-- Courses list -->
    <section id="list" class="space-y-4 mb-8">
      <!-- JS will fill this -->
    </section>

    <!-- Pagination -->
    <nav id="pager" class="flex items-center justify-center gap-2 mb-10"></nav>

    <!-- Registration form at bottom -->
    <section class="card max-w-xl mx-auto">
      <h2 class="text-xl font-medium mb-2">Course Registration</h2>
      <p class="small mb-4">Enter your details and the course name you want to register for.</p>

      <form id="signup">
        <div class="grid grid-cols-1 gap-3">
          <input id="regName" name="name" placeholder="Full name" class="p-2 border rounded-md" required />
          <input id="regEmail" name="email" type="email" placeholder="Email address" class="p-2 border rounded-md" required />
          <select id="regCourse" name="courseId" class="p-2 border rounded-md" required>
            <option value="">Choose a course</option>
          </select>
          <div class="flex gap-2">
            <button type="submit" class="flex-1 py-2 rounded-md bg-sky-600 text-white">Register</button>
          </div>
        </div>
        <p id="signupMsg" class="small text-green-700 mt-3 hidden"></p>
      </form>
    </section>

    <footer class="mt-8 text-center small text-slate-600">Place these files in the root of your repo: <code>index.html</code> and <code>courses.json</code>. Publish via GitHub Pages.</footer>
  </div>

<script>
/* ========= App state ========= */
let courses = [];            // full dataset loaded from JSON
let filtered = [];           // currently filtered list
let page = 1;
let pageSize = 6;

/* ========= Helpers ========= */
function parsePrice(p){ return parseFloat(String(p).replace(/[^0-9.-]+/g,'')) || 0; }
function formatNumber(n){ return Number(n).toLocaleString(); }

/* ========= Fetch courses.json =========
   NOTE: courses.json must be in same folder as index.html
   On GitHub Pages it will be available at:
   https://annettesaji-design.github.io/course-explorer/courses.json
*/
async function loadData(){
  try{
    const res = await fetch('courses.json', {cache: 'no-store'});
    if(!res.ok) throw new Error('Fetch failed: ' + res.status);
    const data = await res.json();
    // ensure the JSON has the expected fields (courseId,title,instructor,duration,rating,category,price,enrolled)
    courses = data.map(item => ({
      courseId: item.courseId || '',
      title: item.title || '',
      instructor: item.instructor || '',
      duration: item.duration || '',
      rating: Number(item.rating) || 0,
      category: item.category || '',
      price: item.price || '',
      enrolled: item.enrolled || ''
    }));
    // populate category filter & registration dropdown
    populateCategoryFilter();
    populateRegistrationDropdown();
    filtered = courses.slice();
    render();
  } catch(err){
    console.error(err);
    document.getElementById('list').innerHTML = `<div class="card text-red-600">Could not load courses.json — check that the file exists in the repo root. <br/>Console: ${err.message}</div>`;
  }
}

/* ========= Populate UI controls ========= */
function populateCategoryFilter(){
  const catSet = Array.from(new Set(courses.map(c=>c.category))).sort();
  const sel = document.getElementById('category');
  // clear current (keep All)
  sel.innerHTML = '<option value=\"\">All categories</option>';
  catSet.forEach(c => { const o = document.createElement('option'); o.value = c; o.textContent = c; sel.appendChild(o); });
}

function populateRegistrationDropdown(){
  const sel = document.getElementById('regCourse');
  sel.innerHTML = '<option value=\"\">Choose a course</option>';
  courses.forEach(c => {
    const o = document.createElement('option');
    o.value = c.courseId;
    o.textContent = `${c.title} — ${c.instructor}`;
    sel.appendChild(o);
  });
}

/* ========= Render functions ========= */
function render(){
  applyFiltersAndSort(); // ensures filtered is current
  renderPage();
  renderPager();
  updateResultsInfo();
}

function applyFiltersAndSort(){
  const q = document.getElementById('search').value.trim().toLowerCase();
  const cat = document.getElementById('category').value;
  const sortVal = document.getElementById('sort').value;
  pageSize = parseInt(document.getElementById('pageSize').value, 10) || 6;

  // filter
  filtered = courses.filter(c => {
    const text = `${c.title} ${c.instructor} ${c.category}`.toLowerCase();
    const matchesQ = !q || text.includes(q);
    const matchesCat = !cat || c.category === cat;
    return matchesQ && matchesCat;
  });

  // sort
  if(sortVal === 'rating_desc') filtered.sort((a,b)=> b.rating - a.rating);
  else if(sortVal === 'rating_asc') filtered.sort((a,b)=> a.rating - b.rating);
  else if(sortVal === 'price_asc') filtered.sort((a,b)=> parsePrice(a.price) - parsePrice(b.price));
  else if(sortVal === 'price_desc') filtered.sort((a,b)=> parsePrice(b.price) - parsePrice(a.price));
  else if(sortVal === 'enrolled_desc') filtered.sort((a,b)=> (Number(b.enrolled)||0) - (Number(a.enrolled)||0));
  // default: keep original order

  // reset page if out of range
  const totalPages = Math.max(1, Math.ceil(filtered.length / pageSize));
  if(page > totalPages) page = totalPages;
}

function renderPage(){
  const list = document.getElementById('list');
  list.innerHTML = '';
  if(filtered.length === 0){
    list.innerHTML = '<div class="card small text-slate-600">No courses match your search/filters.</div>';
    return;
  }

  const start = (page - 1) * pageSize;
  const slice = filtered.slice(start, start + pageSize);

  slice.forEach(c => {
    const card = document.createElement('article');
    card.className = 'card';
    card.innerHTML = `
      <div class="flex items-start justify-between gap-4">
        <div>
          <h3 class="text-lg font-semibold">${escapeHtml(c.title)}</h3>
          <p class="small">Instructor: <strong>${escapeHtml(c.instructor)}</strong></p>
          <p class="small">Duration: ${escapeHtml(c.duration)}</p>
          <p class="small">Category: <span class="px-2 py-0.5 bg-slate-50 rounded">${escapeHtml(c.category)}</span></p>
          <div class="mt-2 small"><span class="font-semibold">Rating:</span> ${c.rating.toFixed(1)} • <span class="font-semibold">Price:</span> ${escapeHtml(c.price)} • <span class="font-semibold">Enrolled:</span> ${escapeHtml(c.enrolled)}</div>
        </div>
        <div class="text-right">
          <button class="enrollBtn px-3 py-1 rounded-md border" data-id="${escapeHtml(c.courseId)}">Enroll</button>
          <div class="small text-slate-500 mt-2">${escapeHtml(c.courseId)}</div>
        </div>
      </div>
    `;
    list.appendChild(card);
  });

  // wire enroll buttons to prefill registration select
  document.querySelectorAll('.enrollBtn').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const id = btn.dataset.id;
      const sel = document.getElementById('regCourse');
      sel.value = id;
      // scroll to form
      document.getElementById('signup').scrollIntoView({behavior:'smooth', block:'center'});
    });
  });
}

function renderPager(){
  const pager = document.getElementById('pager');
  pager.innerHTML = '';
  const total = Math.max(1, Math.ceil(filtered.length / pageSize));

  const makeBtn = (txt, disabled, handler) => {
    const b = document.createElement('button');
    b.textContent = txt;
    b.disabled = !!disabled;
    b.className = 'px-3 py-1 rounded-md border';
    if(disabled) b.style.opacity = '0.5';
    if(handler) b.addEventListener('click', handler);
    return b;
  };

  pager.appendChild(makeBtn('Prev', page === 1, ()=>{ page = Math.max(1, page-1); render(); }));
  // show up to 5 pages
  const start = Math.max(1, page - 2);
  const end = Math.min(total, start + 4);
  for(let p = start; p <= end; p++){
    const b = makeBtn(p, false, ()=>{ page = p; render(); });
    if(p === page){ b.classList.add('bg-sky-600','text-white'); }
    pager.appendChild(b);
  }
  pager.appendChild(makeBtn('Next', page === total, ()=>{ page = Math.min(total, page+1); render(); }));
}

function updateResultsInfo(){
  const info = document.getElementById('resultsInfo');
  const total = filtered.length;
  const start = Math.min(total, (page-1)*pageSize + 1);
  const end = Math.min(total, (page-1)*pageSize + pageSize);
  info.textContent = `Showing ${start}-${end} of ${total}`;
}

/* ========= Utilities ========= */
function escapeHtml(s){
  if(!s) return '';
  return String(s).replace(/[&<>"']/g, ch => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[ch]));
}

/* ========= Events ========= */
document.getElementById('search').addEventListener('input', ()=>{ page = 1; render(); });
document.getElementById('category').addEventListener('change', ()=>{ page = 1; render(); });
document.getElementById('sort').addEventListener('change', ()=>{ page = 1; render(); });
document.getElementById('pageSize').addEventListener('change', ()=>{ page = 1; render(); });

/* ========= Registration form ========= */
document.getElementById('signup').addEventListener('submit', (ev)=>{
  ev.preventDefault();
  const name = document.getElementById('regName').value.trim();
  const email = document.getElementById('regEmail').value.trim();
  const courseId = document.getElementById('regCourse').value;

  // basic validation
  if(!name || !email || !courseId){
    const msg = document.getElementById('signupMsg');
    msg.classList.remove('hidden');
    msg.classList.remove('text-green-700');
    msg.classList.add('text-red-600');
    msg.textContent = 'Please fill name, email, and choose a course.';
    return;
  }

  // success (demo) — in a real app you'd POST to a server
  const msg = document.getElementById('signupMsg');
  msg.classList.remove('hidden');
  msg.classList.remove('text-red-600');
  msg.classList.add('text-green-700');
  const course = courses.find(c=>c.courseId === courseId);
  msg.textContent = `Thanks ${name.split(' ')[0]}! You are registered for "${course ? course.title : courseId}".`;

});

/* ========= Start ========= */
loadData();
</script>

</body>
</html>
